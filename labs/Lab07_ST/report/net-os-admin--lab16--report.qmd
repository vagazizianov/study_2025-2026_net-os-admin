---
title: "Лабораторная работа №7"
author: "Газизянов Владислав Альбертович"
subtitle: "Адресация IPv4 и IPv6. Настройка DHCP"
license: "CC BY"
---

# Цель работы
Получение практических навыков настройки службы DHCP для распределения адресов IPv4 и IPv6 в сетевой среде.

# Задание
1. Настроить DHCP-сервис для IPv4-адресации
2. Настроить DHCPv6 без отслеживания состояния (Stateless)
3. Настроить DHCPv6 с отслеживанием состояния (Stateful)
4. Исследовать процесс распределения адресов и сетевые пакеты

# Выполнение лабораторной работы

## Настройка DHCP для IPv4

### Создание топологии сети
В GNS3 реализована топология сети с маршрутизатором VyOS и клиентским устройством VPCS. Настроены названия устройств согласно шаблону, активирован захват сетевого трафика.

![Топология сети в GNS3](image/1.png)

### Установка и настройка VyOS
Выполнена установка образа VyOS на маршрутизатор. Настроены системные параметры: имя хоста, доменное имя, пользовательский доступ. Удалён стандартный пользователь vyos.

![Настройка маршрутизатора VyOS](image/2.png)

### Конфигурация IPv4-адресации
На интерфейсе eth0 маршрутизатора настроен IPv4-адрес 10.0.0.1/24, который будет служить шлюзом по умолчанию для клиентов сети.

### Настройка DHCP-сервера для IPv4
На маршрутизаторе настроен DHCP-сервер со следующими параметрами:
- Имя общей сети: username
- Доменное имя: username.net
- DNS-сервер: 10.0.0.1
- Подсеть: 10.0.0.0/24
- Диапазон адресов: 10.0.0.2 - 10.0.0.253
- Шлюз по умолчанию: 10.0.0.1

![Конфигурация DHCP-сервера IPv4](image/3.png)

### Проверка статистики DHCP
Просмотрена статистика работы DHCP-сервера и список выданных адресов до подключения клиентов. Сервер готов к работе, но активных аренд нет.

![Статистика DHCP-сервера до подключения клиентов](image/4.png)

### Настройка клиентского устройства
На клиенте PC1 активирован DHCP-клиент с опцией -d для подробного вывода информации. Получен IPv4-адрес из указанного диапазона.

![Получение адреса по DHCP на клиенте](image/5.png)

### Проверка сетевой конфигурации
Проверена IP-конфигурация клиента, выполнен ping маршрутизатора для проверки связности. Адрес успешно получен, маршрутизатор доступен.

![Проверка связи с маршрутизатором](image/6.png)

### Мониторинг работы DHCP
После подключения клиента просмотрена обновлённая статистика DHCP-сервера. Зафиксирована выданная аренда адреса с указанием MAC-адреса клиента и времени аренды.

![Статистика DHCP после подключения клиента](image/7.png)

### Анализ сетевого трафика
Исследованы захваченные пакеты DHCP: DISCOVER, OFFER, REQUEST, ACKNOWLEDGE. Проанализированы поля пакетов и процесс четырёхэтапного получения адреса.

![Анализ DHCP-пакетов](image/8.png)

## Настройка DHCPv6

### Расширение топологии сети
Дополнена топология сети для IPv6-тестирования. Добавлены новые сегменты сети с использованием интерфейсов eth1 и eth2 маршрутизатора.

![Расширенная топология для IPv6](image/9.png)

### Конфигурация IPv6-адресации
На маршрутизаторе настроены IPv6-адреса:
- eth1: 2000::1/64 (для Stateless DHCPv6)
- eth2: 2001::1/64 (для Stateful DHCPv6)

### Настройка DHCPv6 без отслеживания состояния
На интерфейсе eth1 настроен DHCPv6 Stateless с включением флага other-config-flag. Клиенты получат IPv6-адреса через SLAAC, а дополнительную информацию (DNS) - через DHCPv6.

![Настройка DHCPv6 Stateless](image/10.png)

### Тестирование DHCPv6 Stateless
На клиенте PC2 проверена сетевая конфигурация, выполнен ping маршрутизатора. Клиент получил IPv6-адрес через SLAAC, но DNS-настройки отсутствуют.

![Проверка сети на PC2](image/11.png)

### Получение DNS-настроек через DHCPv6
На PC2 запущен dhclient с опцией -S для получения только конфигурационной информации. Клиент успешно получил адрес DNS-сервера через DHCPv6.

![Получение DNS через DHCPv6](image/12.png)

### Настройка DHCPv6 с отслеживанием состояния
На интерфейсе eth2 настроен DHCPv6 Stateful с включением флага managed-flag. Определён диапазон адресов 2001::100 - 2001::199 для выдачи клиентам.

![Настройка DHCPv6 Stateful](image/13.png)

### Тестирование DHCPv6 Stateful
На клиенте PC3 запущен dhclient для получения полной конфигурации. Клиент получил IPv6-адрес из заданного диапазона, шлюз по умолчанию и DNS-сервер.

![Получение адреса через DHCPv6 Stateful](image/14.png)

### Мониторинг DHCPv6-аренд
Просмотрены аренды DHCPv6 на маршрутизаторе. Зафиксированы выданные адреса с указанием DUID клиентов и сроков аренды.

![Аренды DHCPv6 на маршрутизаторе](image/15.png)

### Сравнение режимов DHCPv6
Проведено сравнение работы DHCPv6 в двух режимах:
- Stateless: адреса через SLAAC, дополнительная информация через DHCPv6
- Stateful: полная конфигурация через DHCPv6

### Анализ пакетов DHCPv6
Исследованы захваченные пакеты DHCPv6: SOLICIT, ADVERTISE, REQUEST, REPLY. Проанализированы отличия от DHCPv4 и специфика работы в IPv6-среде.


# Выводы

- Освоены практические навыки настройки DHCP-сервера для распределения IPv4-адресов
- Изучены принципы работы DHCPv6 в двух режимах: Stateless и Stateful
- Приобретён опыт настройки маршрутизатора VyOS для работы с DHCP
- Освоены методы мониторинга работы DHCP-сервера и анализа выданных аренд
- Получены навыки анализа сетевого трафика DHCP/DHCPv6 с использованием сниффера
- Изучены различия в процессах получения адресов IPv4 и IPv6
- Освоена техника настройки клиентских устройств для работы с различными режимами DHCP
- Получен опыт диагностики сетевых проблем, связанных с автоматическим назначением адресов
